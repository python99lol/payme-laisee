<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PayMe åˆ©æ˜¯ Â· è‘—æ•¸å„ªæƒ </title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: #f0f2f5;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 20px rgba(0,0,0,0.1);
            max-width: 600px;
            width: 100%;
            text-align: center;
        }
        h1 { color: #333; margin-bottom: 10px; }
        .subtitle { 
            color: #666; 
            margin-bottom: 30px;
            background: #e8f5e9;
            padding: 12px;
            border-radius: 8px;
            display: block;
        }
        .loading { color: #666; margin: 20px 0; }
        .error-box {
            background: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            display: none;
        }
        .user-badge {
            background: #e3f2fd;
            padding: 10px 15px;
            border-radius: 20px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 20px;
            color: #1976d2;
            font-weight: 500;
        }
        .link-card {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .price-tag {
            font-weight: bold;
            color: #0098ea;
            font-size: 1.1em;
        }
        .pay-btn {
            background: #0098ea;
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            min-width: 80px;
        }
        .pay-btn:hover { background: #0087d1; }
        .pay-btn:disabled {
            background: #ccc;
            cursor: wait;
        }
        .pay-btn.loading-btn::after { content: "..."; }
        .note {
            font-size: 12px;
            color: #666;
            margin-top: 15px;
            padding: 10px;
            background: #f5f5f5;
            border-radius: 6px;
        }
        .cors-warning {
            background: #fff3cd;
            color: #856404;
            padding: 10px;
            border-radius: 6px;
            margin: 15px 0;
            font-size: 13px;
        }
        .mock-badge {
            background: #fff3e0;
            color: #e65100;
            padding: 4px 10px;
            border-radius: 16px;
            font-size: 12px;
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ’° PayMe åˆ©æ˜¯</h1>
        <p class="subtitle">
            ğŸ ç›´æ¥é»æ“Šé ˜å– Â· è‡ªå‹•å¸¶å…¥æœ€æ–° Token
            <span class="mock-badge">GitHub Pages éœæ…‹ç‰ˆ</span>
        </p>
        
        <div id="error-box" class="error-box"></div>
        
        <div id="content-area">
            <div class="user-badge">
                ğŸ‘¤ <span id="user-name">è¨ªå®¢</span>
            </div>
            
            <div class="cors-warning" id="cors-warning" style="display: none;">
                âš ï¸ ç„¡æ³•é€£æ¥ HSBC ä¼ºæœå™¨ (CORS é˜»æ“‹)ã€‚<br>
                <strong>æ­£åœ¨ä½¿ç”¨ã€Œç¤ºç¯„æ¨¡å¼ã€â€”â€” Token ç‚ºæ¨¡æ“¬è³‡æ–™ï¼Œåƒ…æ¸¬è©¦é–‹å•Ÿé€£çµåŠŸèƒ½ã€‚</strong>
            </div>
            
            <h3 style="margin-bottom: 15px; color: #333;">æ–°åœ°å•†å ´è¬ç”¨åˆ¸</h3>
            <div id="links-container">
                <!-- å‹•æ…‹è¼‰å…¥ï¼Œæˆ–ä¿ç•™éœæ…‹å‚™ä»½ -->
            </div>
            <div class="note">
                ğŸ’¡ é»æ“Šã€Œé ˜å–ã€å¾Œæœƒå˜—è©¦ç²å–æœ€æ–° Tokenï¼Œå¦‚ CORS å¤±æ•—å‰‡è‡ªå‹•ä½¿ç”¨æ¨¡æ“¬ Token<br>
                ğŸ“± æŒ‰éˆ•æœƒç›´æ¥é–‹å•Ÿ PayMe é€£çµï¼Œåˆ†äº«é€£çµç„¡æ•ˆ
            </div>
        </div>
    </div>

    <script>
        // --------------------------------------------
        //  GitHub Pages éœæ…‹ç‰ˆ - ç„¡éœ€ Telegram é©—è­‰
        //  å®Œå…¨ç§»é™¤ Telegram Widgetï¼Œç›´æ¥é¡¯ç¤ºå„ªæƒ 
        // --------------------------------------------

        // HSBC API Key (ä»ç„¶ä¿ç•™ï¼Œä½†å‰ç«¯ fetch æœƒå›  CORS å¤±æ•—)
        const HSBC_API_KEY = '9104b7e6-ded0-4998-a019-074477573c46';
        const HSBC_API_URL = 'https://paymepromotions.hsbc.com.hk/api/tc/draw/time-token';
        
        // æ¨¡æ“¬ Token - ç•¶ CORS å¤±æ•—æ™‚è‡ªå‹•ä½¿ç”¨
        const MOCK_TOKEN = 'gh-pages-static-token-' + Date.now();

        // å„ªæƒ åˆ—è¡¨è³‡æ–™ (ç›´æ¥å…§åµŒï¼Œç„¡éœ€å¾Œç«¯)
        const OFFERS = [
            { name: 'æ–°åœ°å•†å ´è¬ç”¨åˆ¸ $3-$3', url: 'https://payme.hsbc/m/c90f69cb-04a8-447c-9ea5-9a8849563bd8' },
            { name: 'æ–°åœ°å•†å ´è¬ç”¨åˆ¸ $5-$5', url: 'https://payme.hsbc/m/258c37c8-4cf7-4a3e-8559-8373eff05043' },
            { name: 'æ–°åœ°å•†å ´è¬ç”¨åˆ¸ $120-$8', url: 'https://payme.hsbc/m/35c76840-8a98-4b04-b468-301add0e67dd' },
            { name: 'æ–°åœ°å•†å ´è¬ç”¨åˆ¸ $168-$10', url: 'https://payme.hsbc/m/dc6f7a27-90ee-42f2-9425-c65e9b0b54cb' },
            { name: 'æ–°åœ°å•†å ´éŠ€è¯æ”¯ä»˜å›è´ˆåˆ¸ $500å›$38', url: 'https://payme.hsbc/m/94498590-b8e4-4721-bb52-954e9028087c' },
            { name: 'æ–°åœ°å•†å ´éŠ€è¯æ”¯ä»˜å›è´ˆåˆ¸ $2000å›$128', url: 'https://payme.hsbc/m/7cd803a8-604b-4baa-9bcc-b2706f3d313a' }
        ];

        // åˆå§‹åŒ–é é¢
        function initPage() {
            // è¨­å®šç”¨æˆ¶åç¨± (å›ºå®š)
            document.getElementById('user-name').textContent = 'GitHub è¨ªå®¢';
            
            // æ¸²æŸ“å„ªæƒ åˆ—è¡¨
            renderOffers();
            
            // æª¢æŸ¥ CORS (åªæ˜¯æç¤ºç”¨)
            checkCORS();
        }

        // æ¸²æŸ“å„ªæƒ å¡
        function renderOffers() {
            const container = document.getElementById('links-container');
            container.innerHTML = '';
            
            OFFERS.forEach(offer => {
                const card = document.createElement('div');
                card.className = 'link-card';
                
                const btn = document.createElement('button');
                btn.className = 'pay-btn';
                btn.textContent = 'é ˜å–';
                btn.dataset.baseUrl = offer.url;
                btn.onclick = function() { openPayMe(this); };
                
                card.innerHTML = `<span class="price-tag">${escapeHtml(offer.name)}</span>`;
                card.appendChild(btn);
                container.appendChild(card);
            });
        }

        // å˜—è©¦ç²å–çœŸå¯¦ Tokenï¼Œå¤±æ•—å‰‡ç”¨ Mock Token
        async function fetchToken() {
            // å˜—è©¦å‘¼å« HSBC API (ä¸€å®š CORS å¤±æ•—ï¼Œä½†æˆ‘å€‘ catch å¾Œç”¨ Mock)
            try {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 3000); // 3ç§’ timeout
                
                const response = await fetch(HSBC_API_URL, {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json',
                        'Accept-Language': 'zh-HK,zh;q=0.9',
                        'Apikey': HSBC_API_KEY,
                        'Cache-Control': 'no-cache',
                        'Content-Type': 'application/json',
                        'Referer': 'https://paymepromotions.hsbc.com.hk/tc/game'
                    },
                    signal: controller.signal
                }).catch(error => {
                    // å¿…å®š CORS errorï¼Œç›´æ¥æ‹‹å‡º
                    throw new Error('CORS blocked');
                });

                clearTimeout(timeoutId);
                
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                
                let token = await response.text();
                token = token.trim().replace(/^"|"$/g, '');
                return { success: true, token, isMock: false };
                
            } catch (error) {
                console.warn('ä½¿ç”¨æ¨¡æ“¬ Token (CORS ç„¡æ³•ç¹é):', error.message);
                
                // é¡¯ç¤º CORS æç¤º (ä½†å””é˜»ç¤™ä½¿ç”¨)
                document.getElementById('cors-warning').style.display = 'block';
                
                // è¿”å›å‹•æ…‹æ¨¡æ“¬ Token (æ¯æ¬¡ä¸åŒï¼Œä½†å””å½±éŸ¿ PayMe é€£çµ)
                return { 
                    success: true, 
                    token: MOCK_TOKEN, 
                    isMock: true 
                };
            }
        }

        // é–‹å•Ÿ PayMe (æ ¸å¿ƒåŠŸèƒ½)
        async function openPayMe(button) {
            if (button.disabled) return;
            
            button.disabled = true;
            button.classList.add('loading-btn');
            const originalText = 'é ˜å–';
            
            try {
                // ç²å– Token (çœŸå¯¦æˆ–æ¨¡æ“¬)
                const result = await fetchToken();
                
                if (!result.success) {
                    throw new Error('ç„¡æ³•ç²å– Token');
                }
                
                console.log('ä½¿ç”¨ token:', result.token, result.isMock ? '(æ¨¡æ“¬)' : '(çœŸå¯¦)');
                
                // çµ„åˆå®Œæ•´ URL
                const baseUrl = button.dataset.baseUrl;
                const separator = baseUrl.includes('?') ? '&' : '?';
                const fullUrl = `${baseUrl}${separator}token=${encodeURIComponent(result.token)}`;
                
                // é–‹å•Ÿ PayMe
                window.open(fullUrl, '_blank');
                
                // æŒ‰éˆ•å›é¥‹
                button.textContent = 'å·²é–‹å•Ÿ';
                setTimeout(() => {
                    button.textContent = originalText;
                    button.disabled = false;
                    button.classList.remove('loading-btn');
                }, 2000);
                
            } catch (error) {
                console.error('éŒ¯èª¤:', error);
                
                // å³ä½¿å¤±æ•—ï¼Œä»ç„¶æä¾›ç›´æ¥é–‹å•Ÿ (å””åŠ  token)
                if (confirm('ç„¡æ³•å–å¾— Tokenï¼Œæ˜¯å¦ç›´æ¥é–‹å•Ÿé€£çµï¼Ÿ')) {
                    window.open(button.dataset.baseUrl, '_blank');
                }
                
                button.textContent = 'é‡è©¦';
                button.disabled = false;
                button.classList.remove('loading-btn');
            }
        }

        // æª¢æŸ¥ CORS (åªä½œæç¤º)
        async function checkCORS() {
            try {
                await fetch(HSBC_API_URL, { 
                    method: 'HEAD',
                    mode: 'no-cors'  // é€™ä¸æœƒå›å‚³ç‹€æ…‹ï¼Œä½†è‡³å°‘å””æœƒ error
                });
                // å¦‚æœçœŸä¿‚å¾—ï¼Œå°±éš±è— warning (ä½† no-cors å¹¾ä¹å””æœƒæˆåŠŸ)
            } catch (e) {
                document.getElementById('cors-warning').style.display = 'block';
            }
        }

        // å®‰å…¨è½‰ç¾©
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // å•Ÿå‹•
        initPage();
    </script>
</body>
</html>
